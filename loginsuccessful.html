<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Inventory System</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>

    <nav>
        <div class="logo-container">
            <img src="../static/cropwise_logo.png" alt="Logo" class="logo">
            <h1>CropWise</h1>
        </div>
        <ul>
            <li class="account-dropdown">
                <a href="#account">My Account | admin</a>
                <div class="dropdown-content">
                    <a href="#profile">Profile</a>
                    <a href="#settings">Settings</a>
                    <a href="/">Logout</a>
                </div>
            </li>
        </ul>
    </nav>
    
    <div class="main-nav">
        <ul>
            <li><a href="/home">Home</a></li>
            <li><a href="/loginsuccessful">Crop Inventory</a></li>
            <li><a href="#Harvest-Management">Harvest Management</a></li>
        </ul>
    </div>

    <div class="container">
        <button id="toggle-add-crop-form">+ New Crop</button>

        <div id="add-crop-form" style="display:none;">
            <h2>Add Crop</h2>
            <input type="text" id="localName" placeholder="Local Name" required>
            <select id="category" required>
                <option value="" disabled selected>Select Category</option>
                <option value="Vegetables">Vegetables</option>
                <option value="Fruits">Fruits</option>
                <option value="Fibre Crop">Fibre Crop</option>
                <option value="Nut">Nut</option>
                <option value="Root and Tuber">Root and Tuber</option>
                <option value="Stimulant">Stimulant</option>
                <option value="Tobacco">Tobacco</option>
                <option value="Pulse">Pulse</option>
                <option value="Oil Crop">Oil Crop</option>
            </select>
            <select id="seasonality" required>
                <option value="" disabled selected>Select Seasonality</option>
                <option value="Wet">Wet</option>
                <option value="Dry">Dry</option>
                <option value="Wet and Dry">Wet and Dry</option>
            </select>
            <input type="number" id="itemCode" placeholder="Item Code" required>
            <input type="text" id="year" placeholder="Year" required>
            <select id="flagDescription" required>
                <option value="" disabled selected>Select Flag Description</option>
                <option value="Organic">Organic</option>
                <option value="Non-GMO">Non-GMO</option>
                <option value="Hybrid">Hybrid</option>
                <option value="Heirloom">Heirloom</option>
            </select>
            <input type="date" id="harvestDate" required>
            <input type="number" id="quantity" placeholder="Quantity" required>
            <button onclick="addCrop()">Add/Update Crop</button>
        </div>

        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search for crops..." onkeyup="search()">
        </div>

        <div id="crop-table">
            <h2>Crop List</h2>
            <div id="sort-options" class="sort-by-dropdown">
                <h4>Sort By:</h4>
                <select id="sortBy" onchange="sortCrops()">
                    <option value="localName">Local Name</option>
                    <option value="category">Category</option>
                    <option value="seasonality">Seasonality</option>
                    <option value="itemCode">Item Code</option>
                    <option value="year">Year</option>
                    <option value="flagDescription">Flag Description</option>
                    <option value="harvestDate">Harvest Date</option>
                    <option value="quantity">Quantity</option>
                </select>
                <h4>Sort Order:</h4>
                <select id="sortOrder" onchange="sortCrops()">
                    <option value="ascending">Ascending</option>
                    <option value="descending">Descending</option>
                </select>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Local Name</th>
                        <th>Category</th>
                        <th>Seasonality</th>
                        <th>Item Code</th>
                        <th>Year</th>
                        <th>Flag Description</th>
                        <th>Harvest Date</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="crop-list">
                    <!-- Crop entries will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let crops = [];
        let editIndex = null;

        document.getElementById('toggle-add-crop-form').addEventListener('click', function() {
            var form = document.getElementById('add-crop-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });

        function addCrop() {
            var localName = document.getElementById('localName').value;
            var category = document.getElementById('category').value;
            var seasonality = document.getElementById('seasonality').value;
            var itemCode = document.getElementById('itemCode').value;
            var year = document.getElementById('year').value;
            var flagDescription = document.getElementById('flagDescription').value;
            var harvestDate = document.getElementById('harvestDate').value;
            var quantity = document.getElementById('quantity').value;

            if (editIndex !== null) {
                crops[editIndex] = {
                    localName,
                    category,
                    seasonality,
                    itemCode,
                    year,
                    flagDescription,
                    harvestDate,
                    quantity
                };
                editIndex = null; // Reset edit index
            } else {
                crops.push({
                    localName,
                    category,
                    seasonality,
                    itemCode,
                    year,
                    flagDescription,
                    harvestDate,
                    quantity
                });
            }

            displayCrops(crops);
            document.getElementById('add-crop-form').reset();
            document.getElementById('add-crop-form').style.display = 'none';
        }

        function editCrop(index) {
            const crop = crops[index];
            document.getElementById('localName').value = crop.localName;
            document.getElementById('category').value = crop.category;
            document.getElementById('seasonality').value = crop.seasonality;
            document.getElementById('itemCode').value = crop.itemCode;
            document.getElementById('year').value = crop.year;
            document.getElementById('flagDescription').value = crop.flagDescription;
            document.getElementById('harvestDate').value = crop.harvestDate;
            document.getElementById('quantity').value = crop.quantity;

            editIndex = index;
            document.getElementById('add-crop-form').style.display = 'block';
        }

        function sortCrops() {
            const sortBy = document.getElementById("sortBy").value;
            const sortOrder = document.getElementById("sortOrder").value;
            const isDescending = sortOrder === "descending";

            crops.sort((a, b) => {
                let valA = a[sortBy];
                let valB = b[sortBy];

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) return isDescending ? 1 : -1;
                if (valA > valB) return isDescending ? -1 : 1;
                return 0;
            });

            displayCrops(crops);
        }

        function displayCrops(crops) {
            const cropList = document.getElementById("crop-list");
            cropList.innerHTML = "";

            crops.forEach((crop, index) => {
                const cropRow = document.createElement("tr");
                cropRow.innerHTML = `
                    <td>${crop.localName || ''}</td>
                    <td>${crop.category || ''}</td>
                    <td>${crop.seasonality || ''}</td>
                    <td>${crop.itemCode || ''}</td>
                    <td>${crop.year || ''}</td>
                    <td>${crop.flagDescription || ''}</td>
                    <td>${crop.harvestDate || ''}</td>
                    <td>${crop.quantity || ''}</td>
                    <td>
                        <button onclick="editCrop(${index})">Edit</button>
                        <button onclick="deleteCrop(this)">Delete</button>
                    </td>
                `;
                cropList.appendChild(cropRow);
            });
        }

        function deleteCrop(button) {
            var row = button.parentNode.parentNode;
            var index = row.rowIndex - 1;
            crops.splice(index, 1);
            displayCrops(crops);
        }

        function search() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const filteredCrops = crops.filter(crop => {
                return crop.localName.toLowerCase().includes(searchTerm) ||
                    crop.category.toLowerCase().includes(searchTerm) ||
                    crop.seasonality.toLowerCase().includes(searchTerm) ||
                    crop.itemCode.toString().includes(searchTerm) ||
                    crop.year.toString().includes(searchTerm) ||
                    crop.flagDescription.toLowerCase().includes(searchTerm) ||
                    crop.harvestDate.toLowerCase().includes(searchTerm) ||
                    crop.quantity.toString().includes(searchTerm);
            });
            displayCrops(filteredCrops);
        }
    </script>
    
</body>
</html>
