from flask import Flask, jsonify, request
from inventory_module import crop_inventory, CATEGORY_ORDER, SEASONALITY_ORDER, FLAG_DESCRIPTION_ORDER

app = Flask(__name__)

@app.route('/crops', methods=['GET'])
def get_crops():
    return jsonify(crop_inventory)

@app.route('/categories', methods=['GET'])
def get_categories():
    return jsonify([category.value for category in CATEGORY_ORDER])  # Return enum values

@app.route('/seasonality', methods=['GET'])
def get_seasonality():
    return jsonify([season.value for season in SEASONALITY_ORDER])  # Return enum values

@app.route('/flag-descriptions', methods=['GET'])
def get_flag_descriptions():
    return jsonify([flag.value for flag in FLAG_DESCRIPTION_ORDER])  # Return enum values

@app.route('/dropdown-options', methods=['GET'])
def dropdown_options():
    return jsonify({
        "categories": [category.value for category in CATEGORY_ORDER],  # Return string values
        "seasonality": [season.value for season in SEASONALITY_ORDER],  # Return string values
        "flag_descriptions": [flag.value for flag in FLAG_DESCRIPTION_ORDER]  # Return string values
    })

@app.route('/crops', methods=['POST'])
def add_new_crop():
    data = request.json
    crop = {
        "Local Name": data.get("local_name"),
        "Category": data.get("category"),
        "Seasonality": data.get("seasonality"),
        "Item Code": data.get("item_code"),
        "Year": data.get("year"),
        "Flag Description": data.get("flag_description"),
        "Harvest Date": data.get("harvest_date"),
        "Quantity": data.get("quantity")
    }
    crop_inventory.append(crop)
    return jsonify({"message": "Crop added successfully"}), 201

@app.route('/crops/<int:index>', methods=['DELETE'])
def delete_existing_crop(index):
    if 0 <= index < len(crop_inventory):
        crop_inventory.pop(index)
        return jsonify({"message": "Crop deleted successfully"})
    return jsonify({"error": "Crop not found"}), 404

@app.route('/crops/<int:index>', methods=['PUT'])
def edit_existing_crop(index):
    if 0 <= index < len(crop_inventory):
        data = request.json
        crop_inventory[index].update(data)  # Update the crop with new data
        return jsonify({"message": "Crop updated successfully"})
    return jsonify({"error": "Crop not found"}), 404

if __name__ == "__main__":
    app.run(debug=True)
